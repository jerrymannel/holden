<div class="container-fluid">

	<div class="row">
		<div class="col-12 mb-2">
			<h2 class="mb-3">
				<i class="bi bi-check2-circle fs-4"></i>
				<span> Tests</span>
				<button class="btn btn-primary buttondoublewidth float-end" (click)="showForm()"> Add test</button>
			</h2>
			<hr>
		</div>
	</div>

	<div class="row">

		<div class="col-2">
			<div class="list-group">
				<div class="list-group-item fakeLink" *ngFor="let test of tests"
					[ngClass]="{'selected': selectedTestID == test._id}" (click)="selectTest(test._id)">
					<span>{{test.name}}</span>
				</div>
			</div>
		</div>

		<div class="col-10">
			<div class="card">
				<!-- HEADER -->
				<div class="card-header">
					<span class="fs-5" *ngIf="selectedTestID">{{createForm.name}}</span>
					<span class="fs-5" *ngIf="!selectedTestID">Add function</span>
					<button class="btn btn-warning btn-sm buttonwidth float-end mx-2"
						(click)="showEditCreateModal = !showEditCreateModal"
						[ngClass]="{'btn-warning':!showEditCreateModal, 'btn-dark':showEditCreateModal}">
						<span *ngIf="!showEditCreateModal">Edit</span>
						<span *ngIf="showEditCreateModal">Cancel</span>
					</button>
					<button class="btn btn-outline-danger btn-sm float-end"
						(click)="showDeleteConfirmation = true;">Remove</button>
				</div>
				<div class="d-flex bg-warning justify-content-end p-2 gap-2 shadow" *ngIf="showDeleteConfirmation">
					<span class="fs-5">Are you sure?</span>
					<button class="btn btn-dark buttonwidth btn-sm" (click)="showDeleteConfirmation = false;">No</button>
					<button class="btn btn-danger buttonwidth btn-sm" (click)="deleteTest()">Yes</button>
				</div>

				<!-- BODY -->
				<div class="card-body">
					<div class="row">
						<div class="col-6">
							<div class="row mb-2">
								<div class="col-md-3">
									<span>Name</span>
								</div>
								<div class="col">
									<input type="text" class="form-control form-control-sm" [(ngModel)]="createForm.name"
										*ngIf="showEditCreateModal">
									<span class="ms-4" *ngIf="!showEditCreateModal"><strong>{{createForm.name}}</strong></span>
								</div>
							</div>
							<div class="row">
								<div class="col-md-3">
									<span>URLs</span>
								</div>
								<div class="col">
									<div class="input-group input-group-sm mb-1" *ngIf="showEditCreateModal">
										<input type="text" class="form-control" [(ngModel)]="url">
										<button class="btn btn-secondary" (click)="addUrl()">Add</button>
									</div>
									<ul class="list-group list-group-numbered">
										<li class="list-group-item p-1" *ngFor="let url of createForm.url">
											{{url}}
											<button class="btn btn-outline-danger btn-sm float-end" *ngIf="showEditCreateModal">X</button>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>

					<div class="bg-light border my-2 px-3">
						<span class="fs-5">Tests</span>
						<span class="fs-6 float-end mt-1">No. of tests: <strong>{{createForm.tests.length}}</strong></span>
					</div>

					<div class=" d-flex flex-row gap-1">

						<div class="d-flex flex-column" style="width: 13rem;">
							<button class="btn btn-dark btn-sm mb-1">Add Test</button>

							<ul class="list-group list-group-numbered">
								<li class="list-group-item fakeLink p-1 fs-6" *ngFor="let step of createForm.tests; let i = index"
									(click)="selectStep(i)" [ngClass]="{'selected': createStep.name === step.name}">
									{{step.name}}
								</li>
							</ul>
						</div>

						<div class="d-flex flex-column border flex-fill p-2 gap-1">
							<div class="d-flex flex-row">
								<em style="width: 10rem;">Name</em>
								<span>{{createStep.name}}</span>
							</div>
							<div class="d-flex flex-row">
								<em style="width: 10rem;">Delimiters</em>
								<span>{{createStep.delimiters.join(" ")}}</span>
							</div>
							<div class="d-flex flex-row">
								<em style="width: 10rem;">Endpoint</em>
								<span>{{createForm.url[createStep.endpoint - 1]}}</span>
							</div>
							<div class="d-flex flex-column">
								<em style="width: 10rem;">Request</em>
								<div class="d-flex flex-column border p-2">
									<div class="d-flex flex-row">
										<em style="width: 10rem;">Method</em>
										<span>{{createStep.request.method}}</span>
									</div>
									<div class="d-flex flex-row">
										<em style="width: 10rem;">URI</em>
										<span>{{createStep.request.uri}}</span>
									</div>
									<div class="d-flex flex-row">
										<em style="width: 10rem;">Expected Status</em>
										<span>{{createStep.request.responseCode}}</span>
									</div>
									<div class="d-flex flex-row">
										<em style="width: 10rem;">Headers</em>
										<span>{{stringify(createStep.request.headers) || "Nil"}}</span>
									</div>
									<div class="d-flex flex-row">
										<em style="width: 10rem;">Body</em>
										<span>{{stringify(createStep.request.body) || "Nil"}}</span>
									</div>
								</div>
							</div>
							<div class="d-flex flex-column">
								<em style="width: 10rem;">Response</em>
								<div class="d-flex flex-column border p-2">
									<div class="d-flex flex-row">
										<em style="width: 10rem;">Headers</em>
										<span>{{stringify(createStep.response.headers) || "Nil"}}</span>
									</div>
									<div class="d-flex flex-row">
										<em style="width: 10rem;">Body</em>
										<span>{{stringify(createStep.response.body) || "Nil"}}</span>
									</div>
								</div>
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>

	</div>


</div>