<div class="container-fluid">

	<div class="row">
		<div class="col-12 mb-2">
			<h2 class="mb-3">
				<i class="bi bi-check2-circle fs-4"></i>
				<span> Tests</span>
				<button class="btn btn-primary buttondoublewidth float-end" (click)="showForm()"> Add test</button>
			</h2>
			<hr>
		</div>
	</div>

	<div class="row">

		<div class="col-2">
			<div class="list-group">
				<div class="list-group-item fakeLink" *ngFor="let test of tests"
					[ngClass]="{'selected': selectedTestID == test._id}" (click)="selectTest(test._id)">
					<span>{{test.name}}</span>
				</div>
			</div>
		</div>

		<div class="col-10">
			<div class="card">
				<!-- HEADER -->
				<div class="card-header">
					<span class="fs-5" *ngIf="selectedTestID">{{createForm.name}}</span>
					<span class="fs-5" *ngIf="!selectedTestID">Add function</span>
					<button class="btn btn-success btn-sm float-end buttonwidth" *ngIf="showEditCreateModal"
						(click)="saveTest()">Save</button>
					<button class="btn btn-warning btn-sm buttonwidth float-end mx-2"
						(click)="showEditCreateModal = !showEditCreateModal"
						[ngClass]="{'btn-warning':!showEditCreateModal, 'btn-dark':showEditCreateModal}"
						*ngIf="!showEditCreateModal"> Edit
						<span *ngIf="showEditCreateModal">Cancel</span>
					</button>
					<button class="btn btn-warning btn-sm buttonwidth float-end mx-2" (click)="selectTest(selectedTestID)"
						[ngClass]="{'btn-warning':!showEditCreateModal, 'btn-dark':showEditCreateModal}"
						*ngIf="showEditCreateModal">
						Cancel
					</button>
					<button class="btn btn-outline-danger btn-sm float-end buttonwidth" *ngIf="!showEditCreateModal"
						(click)="showDeleteConfirmation = true;">Remove</button>
				</div>
				<div class="d-flex bg-warning justify-content-end p-2 gap-2 shadow" *ngIf="showDeleteConfirmation">
					<span class="fs-5">Are you sure?</span>
					<button class="btn btn-dark buttonwidth btn-sm" (click)="showDeleteConfirmation = false;">No</button>
					<button class="btn btn-danger buttonwidth btn-sm" (click)="deleteTest()">Yes</button>
				</div>

				<!-- BODY -->
				<div class="card-body">
					<div class="row">
						<div class="col-6">
							<div class="row mb-2">
								<div class="col-md-3">
									<span>Name</span>
								</div>
								<div class="col">
									<input type="text" class="form-control form-control-sm" [(ngModel)]="createForm.name"
										*ngIf="showEditCreateModal">
									<span class="ms-1" *ngIf="!showEditCreateModal"><strong>{{createForm.name}}</strong></span>
								</div>
							</div>
							<div class="row">
								<div class="col-md-3">
									<span>URLs</span>
								</div>
								<div class="col">
									<div class="input-group input-group-sm mb-1" *ngIf="showEditCreateModal">
										<input type="text" class="form-control" [(ngModel)]="url">
										<button class="btn btn-secondary" (click)="addUrl()">Add</button>
									</div>
									<ul class="list-group list-group-numbered">
										<li class="list-group-item p-1" *ngFor="let url of createForm.url; let i = index">
											{{url}}
											<span class="badge bg-danger fakeLink float-end" *ngIf="showEditCreateModal"
												(click)="removeURL(i)">X</span>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>

					<div class="bg-light border my-2 px-3">
						<span class="fs-5">Tests</span>
						<span class="fs-6 float-end mt-1">No. of tests: <strong>{{createForm.tests.length}}</strong></span>
					</div>

					<div class=" d-flex flex-row gap-1">

						<div class="d-flex flex-column" style="width: 13rem;">
							<button class="btn btn-dark btn-sm mb-1" *ngIf="showEditCreateModal" (click)="addStep()">Add Test</button>

							<ul class="list-group list-group-numbered">
								<li class="list-group-item fakeLink p-1 fs-6" *ngFor="let step of createForm.tests; let i = index"
									(click)="selectStep(i)" [ngClass]="{'selected': i === selectedStepIndex}">
									{{step.name}}
								</li>
							</ul>
						</div>

						<div class="d-flex flex-column border flex-fill p-2 gap-1">
							<div class="d-flex flex-row">
								<span style="width: 10rem;">Name</span>
								<span *ngIf="!showEditCreateModal">{{createForm.tests[selectedStepIndex]?.name}}</span>
								<input *ngIf="showEditCreateModal" type="text" class="form-control form-control-sm"
									[(ngModel)]="createForm.tests[selectedStepIndex].name" style="width: 20rem;">
							</div>
							<div class="d-flex flex-row">
								<span style="width: 10rem;">Delimiters</span>
								<span *ngIf="!showEditCreateModal">{{createForm.tests[selectedStepIndex]?.delimiters.join(" ")}}</span>
								<select *ngIf="showEditCreateModal" class="form-select form-select-sm" style="width: 5rem;"
									[(ngModel)]="createForm.tests[selectedStepIndex].delimiters">
									<option *ngFor="let delim of delimiters" [ngValue]="delim">{{delim.join(",")}}</option>
								</select>
							</div>
							<div class="d-flex flex-row">
								<span style="width: 10rem;">Endpoint</span>
								<span *ngIf="!showEditCreateModal">{{createForm.tests[selectedStepIndex]?.endpoint}}</span>
								<select *ngIf="showEditCreateModal" class="form-select form-select-sm"
									(change)="endpointUpdated($event)" style="width: 20rem;">
									<option *ngFor="let url of createForm.url" [value]="url">{{url}}</option>
								</select>
							</div>
							<div class="d-flex flex-column mt-3">
								<span style="width: 10rem;"><strong>Request</strong></span>
								<div class="d-flex flex-column border-top">
									<div class="d-flex flex-row mt-2">
										<span style="width: 10rem;">Method</span>
										<span *ngIf="!showEditCreateModal">{{createForm.tests[selectedStepIndex]?.request.method}}</span>
										<select *ngIf="showEditCreateModal" class="form-select form-select-sm" style="width: 5rem;"
											[(ngModel)]="createForm.tests[selectedStepIndex].request.method">
											<option [ngValue]="'POST'">POST</option>
											<option [ngValue]="'GET'">GET</option>
											<option [ngValue]="'PUT'">PUT</option>
											<option [ngValue]="'DELETE'">DELETE</option>
										</select>
									</div>
									<div class="d-flex flex-row mt-2">
										<span style="width: 10rem;">URI</span>
										<span *ngIf="!showEditCreateModal">{{createForm.tests[selectedStepIndex]?.request.uri}}</span>
										<input *ngIf="showEditCreateModal" type="text" class="form-control form-control-sm"
											[(ngModel)]="createForm.tests[selectedStepIndex].request.uri" style="width: 20rem;">
									</div>
									<div class="d-flex flex-row mt-2">
										<span style="width: 10rem;">Expected Status</span>
										<span
											*ngIf="!showEditCreateModal">{{createForm.tests[selectedStepIndex]?.request.responseCode}}</span>
										<input *ngIf="showEditCreateModal" type="text" class="form-control form-control-sm"
											[(ngModel)]="createForm.tests[selectedStepIndex].request.responseCode" style="width: 20rem;">
									</div>
									<div class="d-flex flex-row mt-2">
										<span style="width: 10rem;">Headers</span>
										<span *ngIf="!showEditCreateModal">{{stringify(createForm.tests[selectedStepIndex]?.request.headers)
											|| "Nil"}}</span>
										<textarea *ngIf="showEditCreateModal" type="text" class="form-control form-control-sm"
											[(ngModel)]="createForm.tests[selectedStepIndex].request.headers" rows="4"
											style="width: 20rem;"></textarea>
									</div>
									<div class="d-flex flex-row mt-2">
										<span style="width: 10rem;">Body</span>
										<span *ngIf="!showEditCreateModal">{{stringify(createForm.tests[selectedStepIndex]?.request.body) ||
											"Nil"}}</span>
										<textarea *ngIf="showEditCreateModal" type="text" class="form-control form-control-sm"
											[(ngModel)]="createForm.tests[selectedStepIndex].request.body" rows="4"
											style="width: 20rem;"></textarea>
									</div>
								</div>
							</div>
							<div class="d-flex flex-column mt-3">
								<span style="width: 10rem;"><strong>Response</strong></span>
								<div class="d-flex flex-column border-top p-2">
									<div class="d-flex flex-row mt-2">
										<span style="width: 10rem;">Headers</span>
										<span
											*ngIf="!showEditCreateModal">{{stringify(createForm.tests[selectedStepIndex]?.response?.headers)
											|| "Nil"}}</span>
										<textarea *ngIf="showEditCreateModal" type="text" class="form-control form-control-sm"
											[(ngModel)]="createForm.tests[selectedStepIndex].response.headers" rows="4"
											style="width: 20rem;"></textarea>
									</div>
									<div class="d-flex flex-row mt-2">
										<span style="width: 10rem;">Body</span>
										<span *ngIf="!showEditCreateModal">{{stringify(createForm.tests[selectedStepIndex]?.response?.body)
											|| "Nil"}}</span>
										<textarea *ngIf="showEditCreateModal" type="text" class="form-control form-control-sm"
											[(ngModel)]="createForm.tests[selectedStepIndex].response.body" rows="4"
											style="width: 20rem;"></textarea>
									</div>
								</div>
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>

	</div>


</div>